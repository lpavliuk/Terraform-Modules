# AWS ECS Cluster

This module creates Amazon ECS (Elastic Container Service) Service, Task and its Containers in ECS Cluster.

<!-- Next block is generated by terraform-docs following .terraform-docs.yml config -->
<!-- BEGIN_TF_DOCS -->
## Example

```hcl
# main.tf
module "ecs_service" {
  source = "git::https://github.com/lpavliuk/Terraform-Modules.git//aws_ecs_service"

  name                         = "api"
  cluster_id                   = var.cluster_id
  capacity_provider_name       = var.capacity_provider_name
  desired_count                = 2

  containers = [
    {
      name                         = "api"
      links                        = ["mysql"]
      port                         = 52150
      image                        = "registry.example.com/api:dev"
      private_registry_credentials = {
        username = var.gitlab_token_username
        password = var.gitlab_token_secret
      }
      essential                    = true
      target_group_arn             = var.target_group_arn
      health_check                 = {
        endpoint = "/health.check"
      }
      env                          = [{
        name  = "ENVIRONMENT"
        value = "dev"
      }]
    },
    {
      name                         = "mysql"
      port                         = 3306
      essential                    = false
      image                        = "mysql:latest"
    }
  ]
}
```

## Requirements

| Name | Version |
|------|---------|
| <a name="requirement_terraform"></a> [terraform](#requirement\_terraform) | < 2.0.0, >= 1.6.6 |
| <a name="requirement_aws"></a> [aws](#requirement\_aws) | < 6.0, >= 5.22 |

## Inputs

| Name | Description | Type | Default | Required |
|------|-------------|------|---------|:--------:|
| <a name="input_name"></a> [name](#input\_name) | Name of the ECS Service.<br/><br/>**NOTE!** Must contain alphanumeric characters or hyphens (`-`). | `string` | n/a | yes |
| <a name="input_cluster_id"></a> [cluster\_id](#input\_cluster\_id) | ECS Cluster ID for the ECS Service Tasks | `string` | n/a | yes |
| <a name="input_capacity_provider_name"></a> [capacity\_provider\_name](#input\_capacity\_provider\_name) | ECS Capacity Provider Name of the ECS Service | `string` | n/a | yes |
| <a name="input_desired_count"></a> [desired\_count](#input\_desired\_count) | Number of ECS Service Copies to place and keep running | `number` | `1` | no |
| <a name="input_ordered_placement_strategy"></a> [ordered\_placement\_strategy](#input\_ordered\_placement\_strategy) | [Amazon ECS - Placement Strategy](https://docs.aws.amazon.com/AmazonECS/latest/APIReference/API_PlacementStrategy.html) | <pre>object({<br/>    type  = string<br/>    field = optional(string)<br/>  })</pre> | <pre>{<br/>  "field": "attribute:ecs.availability-zone",<br/>  "type": "spread"<br/>}</pre> | no |
| <a name="input_network_configuration"></a> [network\_configuration](#input\_network\_configuration) | Network Configuration.<br/><br/>**NOTE!** The attribute is required and applied only in case `container_network_mode` = `awsvpc`. | <pre>object({<br/>    security_groups = list(string)<br/>    subnet_ids      = list(string)<br/>  })</pre> | `null` | no |
| <a name="input_task_network_mode"></a> [task\_network\_mode](#input\_task\_network\_mode) | Task networking mode to use for its containers.<br/><br/>Available network modes:<br/>  - `none`<br/>  - `bridge`<br/>  - `awsvpc`<br/>  - `host`<br/><br/>[Amazon ECS - Network Mode](https://docs.aws.amazon.com/AmazonECS/latest/developerguide/task_definition_parameters.html#network_mode) | `string` | `"bridge"` | no |
| <a name="input_task_cpu"></a> [task\_cpu](#input\_task\_cpu) | CPU Units used by the ECS Service Task | `number` | `256` | no |
| <a name="input_task_memory"></a> [task\_memory](#input\_task\_memory) | Memory in MiB used by the ECS Service Task | `number` | `256` | no |
| <a name="input_task_log_group_retention_days"></a> [task\_log\_group\_retention\_days](#input\_task\_log\_group\_retention\_days) | CloudWatch Log Group Retention Period Days of the ECS Service Task | `number` | `7` | no |
| <a name="input_task_tags"></a> [task\_tags](#input\_task\_tags) | ECS Service Task Tags | <pre>object({<br/>    name  = string<br/>    value = string<br/>  })</pre> | `null` | no |
| <a name="input_containers"></a> [containers](#input\_containers) | [Amazon ECS - Container Definitions](https://docs.aws.amazon.com/AmazonECS/latest/developerguide/task_definition_parameters.html#container_definitions)<br/><br/>`image` attribute must be defined as **Image\_URL:TAG**. For example: `"registry.example.com/webserver:latest"`.<br/><br/>**NOTE!** if `host_port` attribute is not defined, the port will be assigned automatically!<br/><br/>`endpoint` of `health_check` attribute must start with `/`. For example: `"/api/health"`. | <pre>list(object({<br/>    name                         = string<br/>    port                         = number<br/>    port_range                   = optional(string)<br/>    host_port                    = optional(number)<br/>    host_port_range              = optional(string)<br/>    links                        = optional(list(string), [])<br/>    image                        = string<br/>    private_registry_credentials = optional(object({<br/>      username = string<br/>      password = string<br/>    }))<br/>    essential                    = optional(bool, true)<br/>    target_group_arn             = optional(string)<br/>    cpu                          = optional(number)<br/>    gpu                          = optional(number)<br/>    memory                       = optional(number)<br/>    memory_reservation           = optional(number)<br/>    health_check                 = optional(object({<br/>      endpoint     = string<br/>      interval     = optional(number, 30),<br/>      retries      = optional(number, 3),<br/>      timeout      = optional(number, 5),<br/>      start_period = optional(number)<br/>    }))<br/>    env                          = optional(list(object({<br/>      name  = string,<br/>      value = string<br/>    })), [])<br/>    env_files                    = optional(list(object({<br/>      s3_object_arn = string<br/>    })), [])<br/>    secret_vars                  = optional(list(object({<br/>      name       = string,<br/>      secret_arn = string<br/>    })), [])<br/>    hostname                     = optional(string)<br/>    etc_hosts                    = optional(list(object({<br/>      hostname   = string<br/>      ip_address = string<br/>    })), [])<br/>    disable_networking           = optional(bool, false)<br/>  }))</pre> | n/a | yes |

## Outputs

| Name | Description |
|------|-------------|
| <a name="output_id"></a> [id](#output\_id) | ECS Service ID |
| <a name="output_name"></a> [name](#output\_name) | ECS Service Name |
| <a name="output_task_iam_role"></a> [task\_iam\_role](#output\_task\_iam\_role) | ECS Task IAM Role |
| <a name="output_task_definition_arn"></a> [task\_definition\_arn](#output\_task\_definition\_arn) | ECS Task Definition ARN |
| <a name="output_cloudwatch_log_group_arn"></a> [cloudwatch\_log\_group\_arn](#output\_cloudwatch\_log\_group\_arn) | CloudWatch Log Group ARN |

## Resources

| Name | Type |
|------|------|
| [aws_cloudwatch_log_group.ecs_task](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/cloudwatch_log_group) | resource |
| [aws_ecs_service.this](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/ecs_service) | resource |
| [aws_ecs_task_definition.this](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/ecs_task_definition) | resource |
| [aws_iam_role.ecs_exec_role](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/iam_role) | resource |
| [aws_iam_role.ecs_task_role](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/iam_role) | resource |
| [aws_iam_role_policy.private_registry_credentials](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/iam_role_policy) | resource |
| [aws_iam_role_policy_attachment.task_exec_role_policy](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/iam_role_policy_attachment) | resource |
| [aws_secretsmanager_secret.private_registry_credentials](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/secretsmanager_secret) | resource |
| [aws_secretsmanager_secret_version.private_registry_credentials](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/secretsmanager_secret_version) | resource |
| [aws_iam_policy_document.ecs_task_doc](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/iam_policy_document) | data source |
| [aws_region.current](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/region) | data source |
<!-- END_TF_DOCS -->