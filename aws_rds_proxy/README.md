# AWS RDS Proxy Module

This module creates AWS RDS Proxy with Security Group and IAM Role attached to it.

<!-- Next block is generated by terraform-docs following .terraform-docs.yml config -->
<!-- BEGIN_TF_DOCS -->
## Example

```hcl
# main.tf
module "rds-proxy" {
  source = "git::https://github.com/lpavliuk/Terraform-Modules.git//aws_rds_proxy"

  name               = local.codename
  vpc_subnet_ids     = data.aws_subnets.selected.ids
  security_group_ids = [aws_security_group.this.id]

  target_rds_instance_name = module.rds_instance.name

  users = [
    {
      username = "UserName"
      password = ""
      iam_auth = true
    }
  ]
}

# https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/security_group
resource "aws_security_group" "this" {
  name        = "SG RDS Proxy - ${local.codename}"
  vpc_id      = data.aws_vpc.selected.id
}
```

## Requirements

| Name | Version |
|------|---------|
| <a name="requirement_terraform"></a> [terraform](#requirement\_terraform) | < 2.0.0, >= 1.6.6 |
| <a name="requirement_aws"></a> [aws](#requirement\_aws) | < 7.0, >= 5.22 |

## Inputs

| Name | Description | Type | Default | Required |
|------|-------------|------|---------|:--------:|
| <a name="input_name"></a> [name](#input\_name) | RDS Proxy Name.<br/><br/>**NOTE!**  Must contain 1 to 63 alphanumeric characters or hyphens (`-`). | `string` | n/a | yes |
| <a name="input_engine"></a> [engine](#input\_engine) | Proxy Engine. Available engines:<br/>  - `MYSQL` | `string` | `"MYSQL"` | no |
| <a name="input_vpc_subnet_ids"></a> [vpc\_subnet\_ids](#input\_vpc\_subnet\_ids) | Subnet IDs the RDS Proxy will be provisioned in | `list(string)` | n/a | yes |
| <a name="input_security_group_ids"></a> [security\_group\_ids](#input\_security\_group\_ids) | Security Group IDs to attach to the RDS Proxy | `list(string)` | n/a | yes |
| <a name="input_target_rds_instance_name"></a> [target\_rds\_instance\_name](#input\_target\_rds\_instance\_name) | Target RDS Instance Name | `string` | `null` | no |
| <a name="input_target_rds_cluster_name"></a> [target\_rds\_cluster\_name](#input\_target\_rds\_cluster\_name) | Target RDS Cluster Name | `string` | `null` | no |
| <a name="input_create_read_only_endpoint"></a> [create\_read\_only\_endpoint](#input\_create\_read\_only\_endpoint) | Whether to create a read-only endpoint for the proxy. Only applicable for RDS clusters. | `bool` | `false` | no |
| <a name="input_users"></a> [users](#input\_users) | Proxy Users | <pre>list(object({<br/>    username   = string<br/>    password   = string<br/>    iam_auth   = bool<br/>    # kms_key_id = optional(string)<br/>  }))</pre> | n/a | yes |

## Outputs

| Name | Description |
|------|-------------|
| <a name="output_id"></a> [id](#output\_id) | RDS Proxy ID |
| <a name="output_arn"></a> [arn](#output\_arn) | RDS Proxy ARN |
| <a name="output_name"></a> [name](#output\_name) | RDS Proxy Name |
| <a name="output_default_endpoint"></a> [default\_endpoint](#output\_default\_endpoint) | RDS Proxy Default Endpoint |
| <a name="output_read_only_endpoint"></a> [read\_only\_endpoint](#output\_read\_only\_endpoint) | RDS Proxy Read-Only Endpoint |
| <a name="output_security_group_ids"></a> [security\_group\_ids](#output\_security\_group\_ids) | Security Group IDs of the RDS Proxy |

## Resources

| Name | Type |
|------|------|
| [aws_db_proxy.this](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/db_proxy) | resource |
| [aws_db_proxy_default_target_group.this](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/db_proxy_default_target_group) | resource |
| [aws_db_proxy_endpoint.read_only](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/db_proxy_endpoint) | resource |
| [aws_db_proxy_target.this](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/db_proxy_target) | resource |
| [aws_iam_role.this](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/iam_role) | resource |
| [aws_iam_role_policy.permissions](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/iam_role_policy) | resource |
| [aws_secretsmanager_secret.user](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/secretsmanager_secret) | resource |
| [aws_secretsmanager_secret_version.user](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/secretsmanager_secret_version) | resource |
| [aws_region.current](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/region) | data source |
<!-- END_TF_DOCS -->