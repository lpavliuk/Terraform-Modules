# AWS ECS Cluster

This module creates Amazon ECS (Elastic Container Service) cluster on EC2 with Auto Scaling Group.

<!-- Next block is generated by terraform-docs following .terraform-docs.yml config -->
<!-- BEGIN_TF_DOCS -->
## Example

```hcl
# main.tf
module "ecs_cluster" {
  source = "../../../../modules/aws_ecs_cluster"

  name        = "example"
  subnet_ids  = var.subnet_group_subnets_ids

  node_image_id           = data.aws_ssm_parameter.ecs_node_ami.value
  node_instance_type      = "t4g.micro"
  node_min_count          = 2
  node_security_group_ids = [ aws_security_group.ecs_node.id ]
}

# https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/security_group
resource "aws_security_group" "ecs_node" {
  name_prefix = "ecs-node-example-"
  vpc_id      = var.vpc_id
}

# https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/ssm_parameter
data "aws_ssm_parameter" "ecs_node_ami" {
  # Retrieving Amazon ECS-Optimized AMI metadata:
  # https://docs.aws.amazon.com/AmazonECS/latest/developerguide/retrieve-ecs-optimized_AMI.html
  name = "/aws/service/ecs/optimized-ami/amazon-linux-2023/arm64/recommended/image_id"
}
```

## Requirements

| Name | Version |
|------|---------|
| <a name="requirement_terraform"></a> [terraform](#requirement\_terraform) | < 2.0.0, >= 1.6.6 |
| <a name="requirement_aws"></a> [aws](#requirement\_aws) | < 6.0, >= 5.22 |

## Inputs

| Name | Description | Type | Default | Required |
|------|-------------|------|---------|:--------:|
| <a name="input_name"></a> [name](#input\_name) | Name of the ECS Cluster<br><br>**NOTE!** Must contain alphanumeric characters or hyphens (`-`). | `string` | n/a | yes |
| <a name="input_subnet_ids"></a> [subnet\_ids](#input\_subnet\_ids) | Subnet IDs | `list(string)` | n/a | yes |
| <a name="input_node_image_id"></a> [node\_image\_id](#input\_node\_image\_id) | Node Image (AMI) ID.<br><br>**NOTE!** Changing this will trigger instance refresh! | `string` | n/a | yes |
| <a name="input_node_instance_type"></a> [node\_instance\_type](#input\_node\_instance\_type) | Node Instance Type | `string` | `"t4g.micro"` | no |
| <a name="input_node_min_count"></a> [node\_min\_count](#input\_node\_min\_count) | Minimum number of Nodes in Auto Scaling Group | `number` | `2` | no |
| <a name="input_node_max_count"></a> [node\_max\_count](#input\_node\_max\_count) | Maximum number of Nodes in Auto Scaling Group. Default is the `min_nodes_count` | `number` | `null` | no |
| <a name="input_node_security_group_ids"></a> [node\_security\_group\_ids](#input\_node\_security\_group\_ids) | Security Groups IDs attached to the Node | `list(string)` | `[]` | no |
| <a name="input_node_extra_tags"></a> [node\_extra\_tags](#input\_node\_extra\_tags) | Node Extra Tags | <pre>list(object({<br>    key                 = string,<br>    value               = string,<br>    propagate_at_launch = bool<br>  }))</pre> | `[]` | no |

## Outputs

| Name | Description |
|------|-------------|
| <a name="output_id"></a> [id](#output\_id) | ECS Cluster ID |
| <a name="output_name"></a> [name](#output\_name) | ECS Cluster Name |
| <a name="output_capacity_provider_name"></a> [capacity\_provider\_name](#output\_capacity\_provider\_name) | ECS Capacity Provider Name |
| <a name="output_auto_scaling_group_name"></a> [auto\_scaling\_group\_name](#output\_auto\_scaling\_group\_name) | Auto Scaling Group Name |
| <a name="output_node_launch_template_id"></a> [node\_launch\_template\_id](#output\_node\_launch\_template\_id) | Node Launch Template ID |
| <a name="output_node_launch_template_latest_version"></a> [node\_launch\_template\_latest\_version](#output\_node\_launch\_template\_latest\_version) | Node Launch Template Latest Version |
| <a name="output_node_launch_template_image_id"></a> [node\_launch\_template\_image\_id](#output\_node\_launch\_template\_image\_id) | Node Launch Template Image ID |
| <a name="output_node_iam_role"></a> [node\_iam\_role](#output\_node\_iam\_role) | Node IAM Role Name |
| <a name="output_node_iam_profile"></a> [node\_iam\_profile](#output\_node\_iam\_profile) | Node IAM Instance Profile Name |

## Resources

| Name | Type |
|------|------|
| [aws_autoscaling_group.ecs](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/autoscaling_group) | resource |
| [aws_ecs_capacity_provider.this](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/ecs_capacity_provider) | resource |
| [aws_ecs_cluster.this](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/ecs_cluster) | resource |
| [aws_ecs_cluster_capacity_providers.this](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/ecs_cluster_capacity_providers) | resource |
| [aws_iam_instance_profile.ecs_node](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/iam_instance_profile) | resource |
| [aws_iam_role.ecs_node](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/iam_role) | resource |
| [aws_iam_role_policy_attachment.this_iam_role](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/iam_role_policy_attachment) | resource |
| [aws_launch_template.ecs_node](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/launch_template) | resource |
| [aws_iam_policy_document.ecs_node_role_policy](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/iam_policy_document) | data source |
<!-- END_TF_DOCS -->